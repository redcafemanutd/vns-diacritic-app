<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Processing...</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container mt-5">
    <h3 class="mb-4">Processing files...</h3>
    <div class="progress mb-3">
      <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" style="width: 0%">Starting</div>
    </div>
  </div>

  <script>
    let steps = ["Reading files", "Calling OpenAI", "Validating Output", "Fetching Image", "Saving results", "Complete"];
    let currentStep = 0;

    function checkProgress() {
      fetch(`/progress/{{ job_id }}`)
        .then(response => response.json())
        .then(data => {
          const status = data.status;
          const stepIndex = steps.indexOf(status);
          if (stepIndex > -1) {
            currentStep = stepIndex;
            const percentage = ((stepIndex + 1) / steps.length) * 100;
            const bar = document.getElementById("progressBar");
            bar.style.width = percentage + "%";
            bar.innerText = status;
          }
          if (status !== "Complete") {
            setTimeout(checkProgress, 1000);
          } else {
            window.location.href = "/result/{{ job_id }}";
          }
        });
    }

    fetch("/run_job/{{ job_id }}");  // trigger background job
    checkProgress();
  </script>
</body>
</html>
